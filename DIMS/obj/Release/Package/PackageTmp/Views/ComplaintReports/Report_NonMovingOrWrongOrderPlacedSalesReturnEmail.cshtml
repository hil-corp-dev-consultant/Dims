@{
    Layout = null;
    string CTN = Request.QueryString["CTN"].ToString();


    //DIMS.Models.UserProperties UP = (DIMS.Models.UserProperties)Session["UP"];
    //string SessionUserCode = UP.UserCode;
    //string SessionUserType = UP.UserTypeCode;

}


<!DOCTYPE html>

<html>
<head>
    <script src="~/Scripts/jquery-1.7.1.js"></script>
    <meta name="viewport" content="width=device-width" />
    <title>DIMS CMS Non Moving Or Wrong Order Placed Sales Return Report</title>
</head>
<body style="font-family: Calibri; font-size: 12px;">

    <div style="width: 100%; height: 100%; font-family: Calibri; font-size: 12px;" id="Report_NonMovingOrWrongOrderPlacedSalesReturnEmail">

        <input type="text" id="CTN" value="@CTN" style="display:none;" />

        @*<input type="text" style="display:none;" id="SessionUserCode" value="@SessionUserCode" />*@
        @*<input type="text" style="display:none;" id="SessionUserType" value="@SessionUserType" />*@

        <table style="width: 98%" align="center" border="0">
            <tr>
                <td>
                    <div class="row" align="center" style="width: 100%; margin-bottom: 15px;">
                        <label style="font-size: 18px; color: #0165C4">
                            <b>HIL Limited</b>
                        </label><br />
                        <label style="font-size: 18px; color: #0026ff" id="HeadingLabel">
                            <b>CUSTOMER COMPLAINT NON MOVING OR WRONG ORDER PLACED SALES RETURN REPORT</b>
                        </label><br />
                    </div>
                </td>
            </tr>
        </table>


        <div style="width: 98%;">
            <table style="width: 98%" align="center" border="0">
                <tr>
                    <td>
                        <div style="text-align: left; vertical-align: top; width: 49%; float: left;">
                            <label style="display: none;">
                                Sales Return no.
                                <br />
                                Number:@CTN
                            </label>
                        </div>
                        <div style="text-align: right; vertical-align: top; width: 49%; float: right;">
                            Dated:<label id="Dated"></label>
                        </div>
                    </td>
                </tr>
            </table>
        </div>

        <br />

        <div style="width: 98%" id="SBU3Report">

            <table class="ChildTable" style="width: 98%; border-collapse: collapse;">
                <tr style="background-color: #00FFFF; border: 1px solid Black !important;">
                    <th colspan="5" style="text-align: left; border: 1px solid Black !important;">Sales Return Details:</th>
                </tr>
                <tr>
                    @*<td style="border: 1px solid Black !important;">Sales Representative:</td>
                        <td style="border: 1px solid Black !important;">
                            <label id="SBU3SalesRepresentative"></label>
                        </td>
                        <td style="border: 1px solid Black !important;">
                            Compensation
                            <br />
                            Number:<label id="SBU3Compensation_No"></label>
                        </td>*@
                    <td style="border: 1px solid Black !important;">Sales Return Date:</td>
                    <td style="border: 1px solid Black !important;">
                        <label id="SalesReturnDate"></label>
                    </td>
                    <td style="border: 1px solid Black !important;">Sales Return Number:</td>
                    <td style="border: 1px solid Black !important;">
                        <label id="SBU3ComplaintTrackingNo"></label>
                    </td>
                    @*<td style="border: 1px solid Black !important;">
                            Sales Return
                            <br />
                            Number :<label id="SBU3ComplaintTrackingNo"></label>
                        </td>*@
                </tr>
                <!--<tr>
                    <td style="border: 1px solid Black !important;">Sales Return Date:</td>
                    <td style="border: 1px solid Black !important;">
                        <label id="SalesReturnDate"></label>
                    </td>-->
                @*<td style="border: 1px solid Black !important;">Complaint Attended Date:</td>
                    <td style="border: 1px solid Black !important;">
                        <label id="SBU3ComplaintAttended"></label>
                    </td>*@
                <!--</tr>-->
                <tr>
                    <td style="border: 1px solid Black !important;">Customer Name:</td>
                    <td style="border: 1px solid Black !important;">
                        <label id="SBU3PartyName"></label>
                    </td>
                </tr>
                <tr>
                    <td style="border: 1px solid Black !important;">Location:</td>
                    <td style="border: 1px solid Black !important;">
                        <label id="SBU3Location"></label>
                    </td>
                    <td style="border: 1px solid Black !important;">State:</td>
                    <td style="border: 1px solid Black !important;">
                        <label id="SBU3StateName"></label>
                    </td>
                </tr>
                <tr>
                    <td style="border: 1px solid Black !important;">Material Supplied From:</td>
                    <td style="border: 1px solid Black !important;">
                        <label id="SBU3MaterialSuppliedForm"></label>
                    </td>
                    <td style="border: 1px solid Black !important;">Compensation Mode:</td>
                    <td style="border: 1px solid Black !important;">
                        <label id="SBU3CompensationMode"></label>
                    </td>
                </tr>
            </table>

            <br />
            <table class="ChildTable" style="width: 98%; border-collapse: collapse;" id="SBU3Breakage_Investigation_Details_Table">
                <thead>
                    <tr style="background-color: #00FFFF">
                        <th colspan="8" style="text-align: left; border: 1px solid Black !important;">Investigation Details:</th>
                    </tr>
                    <tr>
                        <th style="border: 1px solid Black !important; text-align: left;">Product Code</th>
                        <th style="border: 1px solid Black !important; text-align: left;">Product Description</th>
                        <th style="border: 1px solid Black !important; text-align: left;">Sales Return No</th>
                        <th style="border: 1px solid Black !important; text-align: left;">Sales Return Date</th>
                        <th style="border: 1px solid Black !important; text-align: left;">Sales Return Qty</th>
                    </tr>
                </thead>
                <tbody></tbody>

            </table>
            <br />
            <table class="ChildTable" style="width: 98%; border-collapse: collapse;" id="SBU3SalesReturn_Recommendation">
            </table>
            <br />


            <table class="ChildTable" style="width: 98%; border-collapse: collapse;">
                <tr>
                    <td style="border: 1px solid Black !important;">
                        Reviewed By
                        <br />
                        <img src="~/Images/DigitalSigns/CSM_BU3.png" id="CSM__SBU3" style="display:none;" />
                        <br />
                        <br />
                        <label id="CSM_SBU3Name"></label>
                        <br>
                        QUALITY ASSURANCE<br />
                        Dated:<label id="SBU3ReviewedDate"></label>
                    </td>
                    <td style="border: 1px solid Black !important;">
                        Approved By
                        <br />
                        <img src="~/Images/DigitalSigns/IKPandit.png" id="QHSBU3" style="display:none;" />
                        <br />
                        I K PANDIT<br />
                        HEAD-QUALITY ASSURANCE<br />
                        Dated:<label id="SBU3ApprovedDate"></label>
                    </td>
                </tr>

                <tr>
                    <td colspan="2" style="border: 1px solid Black !important;">Any Special Remarks:<label id="SBU3AnySpecialRemarksManiS"></label></td>
                </tr>
                <tr>
                    <td colspan="2" style="text-align: right; border: 1px solid Black !important;">version 3 dated 14.01.12</td>
                </tr>
            </table>
        </div>
    </div>

</body>
</html>

<script type="text/javascript">


    $(document).ready(function () {
    debugger
        var CTN = $("#CTN").val();

        $("#Report_NonMovingOrWrongOrderPlacedSalesReturnEmail").css('display', 'none');
        $("#QHSBU1").prop('src', window.location.origin + '/Images/DigitalSigns/IKPandit.png' + '?' + Math.random());
        $("#QHSBU2").prop('src', window.location.origin + '/Images/DigitalSigns/IKPandit.png' + '?' + Math.random());
        $("#QHSBU3").prop('src', window.location.origin + '/Images/DigitalSigns/IKPandit.png' + '?' + Math.random());
        if (CTN == "") {
            $("#Report_NonMovingOrWrongOrderPlacedSalesReturnEmail").empty();
        }
        else {

            var UserCode = $("#SessionUserCode").val();
            var UserType = $("#SessionUserType").val();

            var Data = JSON.stringify({
                CTN: CTN,
                Report: "NonMovingOrWrongOrderPlacedSalesReturnReport",
                UserCode: UserCode,
                UserType: UserType
            });

            $.ajax({
                method: 'POST',
                url: '../../ComplaintReports/GetReportData',
                data: { Data: Data },
            }).then(function successCallback(response) {
                debugger
                if (response == "") {
                    alert("No Data Available");
                    window.close();
                }
                else {
                    debugger;
                    //alert(response);
                    var Data = JSON.parse(response);
                    console.log("Report data : " + Data);
                    var Header = Data["COMP"];
                    //console.log('Header[0]', Header[0])
                    //if (UserType == "CSM" || UserType == "QH" || UserType == "QAM_SBU3" || UserType == "CSM_BU3" || UserType == "QAM_SBU2" || UserType == "CSM_BU2") {

                    //}
                    //else if (Header[0]["DOC_STATUS"] == "Approved" || Header[0]["DOC_STATUS"] == "Compensation Approved and sent") {

                    //}
                    //else {
                    //    alert("Complaint not yet Approved");
                    //    window.close();
                    //}

                    $("#Report_NonMovingOrWrongOrderPlacedSalesReturnEmail").css('display', 'block');
                    //if (Header[0]["PRODUCT_TYPE_NAME"] == "SBU3") {
                        $("#SBU23ReportWallPutty").css('display', 'none');
                    $("#HeadingLabel").text("NON MOVING OR WRONG ORDER PLACED SALES RETURN");

                        //if (Header[0]["DIGITAL_SIGN"] == "True") {
                            //$("#CSM_SBU3Name").val("Joseph Kingslin");
                            $("#CSM__SBU3").prop('src', window.location.origin + '/Images/DigitalSigns/CSM_BU3.png' + '?' + Math.random());
                            $("#CSM__SBU3").css("display", "block");
                            $("#QHSBU3").css("display", "block");
                        //}
                        //else {
                        //    $("#CSM__SBU3").css("display", "none");
                        //    $("#QHSBU3").css("display", "none");
                        //}


                        //$("#SBU1Report").css("display", "none");
                        //$("#SBU23Report").css("display", "none");
                        $("#SBU3Report").css("display", "block");

                        $("#Dated").text(Data["ToDay"]);
                        $("#SBU3ComplaintTrackingNo").text(CTN);
                    $("#SBU3PartyName").text(Header[0]["STOCKIST_NAME"] + "(" + Header[0]["SOLD_TO_PARTY_NO"]+")" ) ;
                    $("#SBU3Location").text(Header[0]["CITY"]);
                    $("#SBU3StateName").text(Header[0]["STATE_DESC"]);
                    $("#SBU3MaterialSuppliedForm").text(Header[0]["PLANT_NAME"]);
                    $("#SBU3ProductCategory").text(Header[0]["DIVISION_NAME"]);
                    $("#SBU3CompensationMode").text("Replacement Basis");
                    $("#SalesReturnDate").text(Header[0]["CREATED_DATE"]);
                        var TRCode = "";
                        var Breakage = Data["Brk_Otr_Lines"];
                        for (var i = 0; i < Breakage.length; i++) {
                            TRCode = TRCode + "<tr>";

                            TRCode = TRCode + "<td style='border: 1px solid Black !important;'>" + Breakage[i]["Product_Code"] + "</td>"
                            TRCode = TRCode + "<td style='border: 1px solid Black !important;'>" + Breakage[i]["PRODUCT_NAME"] + "</td>"
                            TRCode = TRCode + "<td style='border: 1px solid Black !important;'>" + Breakage[i]["Sales_Return_No"] + "</td>"

                            TRCode = TRCode + "<td style='border: 1px solid Black !important;'>" + Breakage[i]["CREATED_DATE"] + "</td>"
                            TRCode = TRCode + "<td style='border: 1px solid Black !important;'>" + Breakage[i]["BILL_QTY"] + "</td>"
                        }

                        $("#SBU3Breakage_Investigation_Details_Table tbody").append(TRCode);

                        var Recommendation_Lines = Data["RCommLines"];
                        TRCode = "<tr style='background-color: #00FFFF'><th colspan='3' style='text-align: left; border: 1px solid Black !important;'>Sales Return Recommondation:</th></tr><tr><td colspan='3' style='border: 1px solid Black !important;'>Based on the above inspection details, the following size's recommended for Sales Return </td></tr>";
                        TRCode = TRCode + "<tr style='border:1px solid black'><th style='text-align:center;font-weight:bolder;font-size:18px;border:1px solid black'>Product Code</th><th style='text-align:center;font-weight:bolder;font-size:18px;border:1px solid black'>Product Name</th><th style='text-align:center;font-weight:bolder;font-size:18px;border:1px solid black'>Recommended Quantity(No's)</th></tr>";

                        for (var i = 0; i < Recommendation_Lines.length; i++) {
                            TRCode += "<tr style='border:1px solid black'>";
                            TRCode += '<td style="text-align:center;border:1px solid black">' + Recommendation_Lines[i]["Product_Code"] + '</td>';
                            TRCode += '<td style="text-align:center;border:1px solid black">' + Recommendation_Lines[i]["PRODUCT_NAME"] + '</td>';
                            TRCode += '<td style="text-align:center;border:1px solid black">' + Recommendation_Lines[i]["BILL_QTY"] + '</td>';
                            TRCode += "</tr>";
                        }

                        $("#SBU3SalesReturn_Recommendation").append(TRCode);

                        /****************************************/

                        $.ajax({
                            url: '/ComplaintRegistration/GetCMSBUHeadDataClient',
                            type: 'GET',
                            success: function (CSMData) {
                                //debugger
                                CSMData = JSON.parse(CSMData);
                                $("#CSM_SBU3Name").text(CSMData[0]["CSM_SBU3_NAME"]);
                                //console.log("BU3 :" + $("#CSM_SBU3Name").text(CSMData[0]["CSM_SBU3_NAME"]) );

                                $.ajax({
                                    url: '/Home/Exportdata',
                                    type: 'POST',
                                    data: { QueryVal: $(Report_NonMovingOrWrongOrderPlacedSalesReturnEmail).html() },
                                    success: function (result) {
                                        //alert(result);
                                        if (result == "ok") {
                                            if (Breakage != "") {
                                            window.location.href = "../../Home/GetPDF_SalesReturn?reportname=NonMovingOrWrongOrderPlacedSalesReturn_" + $("#CTN").val() + "";
                                            /*window.location.href = "../../Home/GetPDF?reportname=NonMovingOrWrongOrderPlacedSalesReturn_" + $("#CTN").val() + "";*/
                                            }
                                            else {
                                                $("#Report_NonMovingOrWrongOrderPlacedSalesReturn").css('display', 'none');
                                                alert("No Data Available.")
                                                window.close();
                                            }
                                                //window.onfocus = function () {
                                            //    window.close();
                                            //}
                                            // window.location.href = "../../Home/DeletePDF?TargetPDFPath=SalesReturn_" + $("#CTN").val() + "";
                                        }
                                    },
                                    error: function (e) {
                                        alert(e);
                                    }
                                });


                            },
                            error: function (e) {
                                alert(e);
                            }
                        });

                        /****************************************/
                    //}

                }
            },
                function errorCallback(response) {
                    alert("Error : " + response);
                });

        }
    });


</script>
