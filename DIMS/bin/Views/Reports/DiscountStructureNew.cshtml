@{
    Layout = null;
    DIMS.Models.UserProperties UP = (DIMS.Models.UserProperties)Session["UP"];
    string SessionSITEDETAIL_CODE = UP.SITEDETAIL_CODE;
    string SessionUserCode = UP.UserCode;
    string SessionUserName = UP.UserName;
    string SessionCOMPANYDETAIL_CODE = UP.COMPANYDETAIL_CODE;
    string SessionUserType = UP.UserTypeCode;
    string SessionUserTypeID = UP.UserType;
}

<section class="content-header" style="padding: 1px 15px 0;">
    <h2 id="UpdateDiscount"><span id="UpdateNav">Create </span>Discount Structure</h2>
    <ol class="breadcrumb">
        <li><a href ng-click="go('home')"><i class="fa fa-dashboard"></i>Home</a></li>
        <li>Discounts/Provisions</li>
        <li class="active"><span id="UpdateNav1">Create </span>Discount Structure</li>
    </ol>
    <nav style="padding: 1px 10px 1px 10px;">
        <div class="row">
            <div class="col-sm-11" id="IconsNavBar">
                <a href ng-click="go('DiscountStructure')">
                    <i class="fa fa-list fa-4" title="List"></i>
                </a>
                <a href ng-click="SaveDiscounts()">
                    <i class="fa fa-floppy-o fa-4" title="Save"></i>
                </a>
            </div>
        </div>
    </nav>
</section>

<input type="text" id="USERNAME_Discounts" style="display: none;" value="@SessionUserName" />
<input type="text" id="USERCODE_Discounts" style="display: none;" value="@SessionUserCode" />
<input type="text" id="USERTYPE_Discounts" style="display: none;" value="@SessionUserType" />
<input class="form-control gray" id="RequestCreatedBy" type="text" disabled="disabled" data-ng-model="RequestCreatedBy" style="display: none" />

<div  class="CustomHeight_Section" style="overflow: auto;">
<section style="padding:0 15px 90px;">
    <div class="row">
    <div class="col-md-12">
        <div class="box box-primary" style="background: white none repeat scroll 0 0; padding: 9px;">
            <div class="box-body">
            <div class="form-group">
                <label class="col-sm-2 control-label" style="color: red; font-size: 18px;margin-left:30px">M=Meter</label>
                <label class="col-sm-2 control-label" style="color: red; font-size: 18px">MT=Metric Tons</label>
            </div>
            <form class="form-horizontal  ng-pristine ng-valid" role="form" style="font-size: small; margin-top: 36px;" action="">

                <div class="form-group">
                    <label class="col-sm-2 control-label">Request Created By</label>
                    <div class="col-sm-3">
                        <input class="form-control gray" id="CreatedBy" type="text" disabled="disabled" data-ng-model="CreatedBy" />
                    </div>
                    <label class="col-sm-3 control-label">Created Date</label>
                    <div class="col-sm-3">
                        <input class="form-control gray" id="CreatedDate" type="text" data-ng-model="CreatedDate" disabled="disabled" />
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">Discount ID</label>
                    <div class="col-sm-3">
                        <input class="form-control gray" id="DiscountID" type="text" disabled="disabled" data-ng-model="DiscountID" />
                    </div>
                </div>



                <div class="form-group">
                    <label class="col-sm-2 control-label">Discount Category</label>
                    <div class="col-sm-3">
                        <select class="form-control gray" id="DiscountCategory">
                            <option value="select">Select</option>
                            <option value="Location Based">Location Based</option>
                            <option value="Stockist Based">Stockist Based</option>
                        </select>
                    </div>
                    <label class="col-sm-3 control-label">State(Location Based) <span style="color: red" id="MandState"></span></label>
                    <div class="col-sm-3">
                        <select class="form-control gray" id="State_Location">
                            <option value="select">Select</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label class="col-sm-2 control-label">Stockist Code <span style="color: red" id="MandStockist"></span></label>
                    <div class="col-sm-3">
                        <div class="input-group add-on">
                            <input class="form-control gray" id="StockistCode" type="text" disabled="disabled" data-ng-model="StockistCode" />
                            <div class="input-group-btn Customer">
                                <span class="btn btn-default" ng-click="Getdata('GetCustomerCodeName','CustomerMasterList','Customer List')"><i class="glyphicon glyphicon-new-window"></i></span>
                            </div>
                        </div>

                    </div>

                    <label class="col-sm-3 control-label">Sales Group Code</label>
                    <div class="col-sm-3">
                        <div class="input-group add-on">
                            @*<textarea class="form-control gray" id="SalesCode" type="text" disabled="disabled" data-ng-model="SalesCode"></textarea>*@
                            <input class="form-control gray" id="SalesCode" type="text" disabled="disabled" data-ng-model="SalesCode" />
                            <div class="input-group-btn SalesGroup">
                                @*<span class="btn btn-default" ng-click="Getdata_Sales('GetSalesGroup','GetSalesGroup','Sales Group List')"><i class="glyphicon glyphicon-new-window"></i></span>*@
                                <span class="btn btn-default" ng-click="SalesGroupPopup()"><i class="glyphicon glyphicon-new-window"></i></span>

                            </div>
                        </div>

                    </div>
                </div>

                <div class="form-group">
                    <label class="col-sm-2 control-label">Stockist Name</label>
                    <div class="col-sm-3">
                        <input class="form-control gray" id="StockistName" type="text" data-ng-model="StockistName" disabled="disabled" />
                    </div>
                    <label class="col-sm-3 control-label">Sales Group Name</label>
                    <div class="col-sm-3">
                        @*<input class="form-control gray" id="SalesGroupName" type="text" data-ng-model="SalesGroupName" disabled="disabled" />*@
                        <textarea class="form-control gray" id="SalesGroupName" type="text" data-ng-model="SalesGroupName" disabled="disabled"></textarea>

                    </div>
                </div>

                <div class="form-group">

                    <label class="col-sm-2 control-label">Zone</label>
                    <div class="col-sm-3">
                        <input class="form-control gray" id="Zone" type="text" data-ng-model="Zone" disabled="disabled" />
                    </div>

                    <label class="col-sm-3 control-label">
                        Discount Applicable
                        <br />
                        (Running Meter in INR)  <span style="color: red">*</span></label>
                    <div class="col-sm-3">
                        <input class="form-control gray" id="DiscountApplicable" type="text" data-ng-model="DiscountApplicable" />
                    </div>
                </div>

                <div class="form-group">
                    <label class="col-sm-2 control-label">State</label>
                    <div class="col-sm-3">
                        <input class="form-control gray" id="State" type="text" data-ng-model="State" disabled="disabled" />
                    </div>
                    <label class="col-sm-3 control-label">Expected Sale (MT) <span style="color: red" id="MandSales"></span></label>
                    <div class="col-sm-3">
                        <input class="form-control gray" id="ExpectedSale" type="text" data-ng-model="ExpectedSale" disabled="disabled" />
                    </div>
                </div>

                <div class="form-group">
                    <label class="col-sm-2 control-label">District</label>
                    <div class="col-sm-3">
                        <input class="form-control gray" id="District" type="text" data-ng-model="District" disabled="disabled" />
                    </div>
                    <label class="col-sm-3 control-label">Target (MT) <span style="color: red" id="MandTarget"></span></label>
                    <div class="col-sm-3">
                        <input class="form-control gray" id="Target" type="text" data-ng-model="Target" disabled="disabled" />
                    </div>
                </div>

                <div class="form-group">
                    <label class="col-sm-2 control-label">Discount Type</label>
                    <div class="col-sm-3">
                        <select class="form-control gray" id="DiscountType">
                            <option value="select" selected="selected">Select</option>
                            <option value="Additional Discount">ADDITIONAL DISCOUNT</option>
                            <option value="Target Discount">TARGET DISCOUNT</option>
                            <option value="Agreed Rate Discount">AGREED RATE DISCOUNT</option>
                            <option value="Other Discount">OTHER DISCOUNT</option>
                        </select>
                    </div>
                    <label class="col-sm-3 control-label">Total Discount (INR/M)</label>
                    <div class="col-sm-3">
                        <input class="form-control gray" id="TotalDiscount" type="text" data-ng-model="TotalDiscount" disabled="disabled" />
                    </div>
                </div>

                <div class="form-group">
                    <label class="col-sm-2 control-label">From Date  <span style="color: red">*</span></label>
                    <div class="col-sm-3">
                        <input class="form-control gray" id="DiscontFrom" type="text" data-ng-model="DiscontFrom" />
                    </div>
                    <label class="col-sm-3 control-label">Net Landing Price (INR/M)</label>
                    <div class="col-sm-3">
                        <input class="form-control gray" id="NetLandingPrice" type="text" data-ng-model="NetLandingPrice" disabled="disabled" />
                    </div>
                </div>

                <div class="form-group">
                    <label class="col-sm-2 control-label">To Date <span style="color: red">*</span></label>
                    <div class="col-sm-3">
                        <input class="form-control" id="DiscountTo" type="text" />
                    </div>
                    <label class="col-sm-3 control-label">Expected NSR (INR) <span id="ExpectedNsrMnd" style="color: red">*</span></label>
                    <div class="col-sm-3">
                        <input class="form-control gray" id="ExpectedNSR" type="text" data-ng-model="ExpectedNSR" />
                    </div>
                </div>

                <div class="form-group">
                    <label class="col-sm-2 control-label">Price Card Rate (INR/M)</label>
                    <div class="col-sm-3">
                        <input class="form-control gray" id="PriceCardRate" type="text" data-ng-model="PriceCardRate" disabled="disabled" />
                    </div>
                    <label class="col-sm-3 control-label">Request Status</label>
                    <div class="col-sm-3">
                        <input class="form-control gray" id="RequestStatus" type="text" data-ng-model="RequestStatus" disabled="disabled" />
                    </div>
                </div>


                <div class="form-group">
                    <label class="col-sm-2 control-label">Remarks</label>
                    <div class="col-sm-3">
                        <textarea class="form-control" id="Remarks" data-ng-model="Remarks" maxlength="300"></textarea>
                    </div>

                    <label class="col-sm-3 control-label ManuHide">KSM (INR/M)</label>
                    <div class="col-sm-3">
                        <input class="form-control gray ManuHide" id="KSM" type="text" />
                    </div>
                </div>

                <div class="form-group">
                    <label class="col-sm-2 control-label ManuHide">CD (INR/M)</label>
                    <div class="col-sm-3">
                        <input class="form-control gray ManuHide" id="CD" type="text" />

                    </div>

                    <label class="col-sm-3 control-label ManuHide">Other Discounts (INR/M) (if any)</label>
                    <div class="col-sm-3">
                        <input class="form-control gray ManuHide" id="Other" type="text" />
                    </div>
                </div>

            </form>
            </div>
        </div>
    </div>
    </div>
</section>
<div class="modal fade" id="SalesLookUp">
    <div class="modal-dialog" style="width: 900px;">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                    ×
                </button>
                <h4 class="modal-title">
                    <b>Sales Groups</b>
                </h4>
            </div>
            <div class="modal-body">
                <div class="table-responsive">
                    <label id="MasterStatus"><b></b></label>
                    <table id="tblSalesgroup" class="table ListTable" width="100%" cellspacing="0">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Sales Group Code</th>
                                <th>Sales Group Name</th>
                                <th>Price Card Rate</th>
                                <th>
                                    <input type="checkbox" id="StockistCheckAll" /></th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-info" style="margin-left: 100px" ng-click="saveSalesGroup()">Save</button>
                <button type="button" class="btn btn-danger" data-dismiss="modal">Cancel</button>
            </div>

        </div>
    </div>
</div>
</div>
<script type="text/javascript">

    $(window).resize(function () {
        $('.CustomHeight_Section').height($(window).height() - 170);
    });
    $('.CustomHeight_Section').height($(window).trigger('resize'));


    $(document).ready(function () {

        GetServerDateTime();

        $(".ManuHide").hide();

        $('#DiscontFrom').datepicker({
            format: 'dd/mm/yyyy',
            autoclose: 'true'
        });
        $('#DiscontFrom').bind('keypress', function (e) {
            return false;
        });
        $('#DiscountTo').datepicker({
            format: 'dd/mm/yyyy',
            autoclose: 'true'
        });
        $('#DiscountTo').bind('keypress', function (e) {
            return false;
        });
    });


    $("#DiscontFrom").datepicker().on("changeDate", function (e) {
        $("#DiscountTo").datepicker('setStartDate', $("#DiscontFrom").val());
        //$("#OrderToDate").data("datepicker").setStartDate((moment(e.date).add(0, 'days')));
        $("#DiscountTo").val("");
    });
    //$("#IssueToDate").datepicker().on("changeDate", function (e) {
    //    if ($("#IssueFromDate").val() == "") {
    //        $("#IssueToDate").val("");
    //    } else {
    //        $("#IssueFromDate").datepicker('setEndDate', $("#IssueToDate").val());
    //    }
    //});

    //function GetServerDateTime() {
    //    $.ajax({
    //        url: '../../Home/getServerDateTime',
    //        type: 'GET',
    //        success: function (response) {
    //            var result = JSON.parse(response.tabledata);
                
    //            if (result == "") {
    //            }
    //            else {
    //                $("#DiscontFrom").datepicker('setEndDate', result);

    //                //$("#DiscountTo").datepicker('setEndDate', result);
    //            }

    //        }

    //    });
    //}
    function GetServerDateTime() {
        $.ajax({
            url: '../../Home/getServerDateTime',
            type: 'GET',
            success: function (response) {
                var result = JSON.parse(response.tabledata);
                var days = daysInMonth(parseInt(result.split('/')[1]), result.split('/')[2]);

                var startdate="01/"+result.split('/')[1]+"/"+ result.split('/')[2];
                var enddate=days+"/"+result.split('/')[1]+"/"+ result.split('/')[2];

                
                if (result == "") {
                }
                else {
                    $("#DiscontFrom").datepicker('setStartDate', startdate);

                    $("#DiscontFrom").datepicker('setEndDate', enddate);

                    $("#DiscountTo").datepicker('setStartDate', startdate);

                    $("#DiscountTo").datepicker('setEndDate', enddate);

                    //$("#DiscountTo").datepicker('setEndDate', result);
                }

            }

        });
    }
    
    //$('#Target').keypress(function (e) {
    //    return onlyNumerics(e);
    //});

    //$('#ExpectedNSR').keypress(function (e) {
    //    return onlyNumerics(e);
    //});

    //$('#ExpectedSale').keypress(function (e) {
    //    return onlyNumerics(e);
    //});

    // $('#DiscountApplicable').keypress(function (e) {
    //return onlyDecimals(e,$(this));
    // });


    allowTwoDecimalPoints($("#DiscountApplicable"));

    allowTwoDecimalPoints($("#ExpectedSale"));

    allowTwoDecimalPoints($("#ExpectedNSR"));

    allowTwoDecimalPoints($("#Target"));

    allowTwoDecimalPoints($("#KSM"));

    allowTwoDecimalPoints($("#CD"));

    allowTwoDecimalPoints($("#Other"));


    function daysInMonth(month, year) {
        return new Date(year, month, 0).getDate();
    }
</script>
